<% for medium in @media %>
	<% unless medium["type"].nil? %>
		<% if medium["type"] == "youtube" %>
			$('#masonry-container').append("<%= j render(:partial => 'videos/show', :locals => {:video => medium, :poll_redis => true}) %>");
		<% elsif medium["type"] == "soundcloud" %>
			$('#masonry-container').append("<%= j render(:partial => 'sounds/show', :locals => {:sound => medium}) %>");
		<% end %>
		$('#masonry-container').masonry('reload');
	<% end %>
<% end %>

<% if @media.next_page %>
  $('.pagination').replaceWith('<%= j will_paginate(@media) %>');
<% else %>
  $('.pagination').remove();
<% end %>

$(document).ajaxComplete(function(){
	$('.poll-redis').each(function(){
		$(this).removeClass('poll-redis');
		var playerId = $(this).attr('id');
	  	var player;
	  	player = new YT.Player(playerId, {
	    	events: {'onReady': createYTEvent(playerId)}
	  	});
	});
	
	function createYTEvent(playerId){ 
		return function (event) {
			var parent_div = $('#'+playerId).parents('.yt_parent');	
			var player = event.target // Set player reference
			player.mute();
			setTimeout(function(){
				player.pauseVideo();
			}, 2000);
			setTimeout(function(){
				parent_div.find('.overlay').fadeOut();
			}, 3000);	
			$(parent_div).mouseover(function(){
				player.seekTo(parent_div.data("start"), 'false');
				player.unMute();	
				player.playVideo();	
			}).mouseout(function(){
				player.pauseVideo();
			});

		}
	}
});