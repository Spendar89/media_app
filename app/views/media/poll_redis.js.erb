<% unless @scroll_media.empty? %>
	$(".media_div").append("<%=j render(:partial => 'poll_redis', :locals => {:new_media =>  @scroll_media[0..5]})%>");
	$('#masonry-container').masonry('reload');
<% else %>
	<% @new_media = @updated_media[0..2] %>
	<% unless @new_media.empty? %>
		$(".media_div").prepend("<%=j render(:partial => 'poll_redis', :locals => {:new_media=> @new_media})%>");
		$('#masonry-container').masonry('reload');
	<% end %>
<% end %>

$(document).ajaxComplete(function(){
	$('.poll-redis').each(function(){
		$(this).removeClass('poll-redis');
		var playerId = $(this).attr('id');
	  	var player;
	  	player = new YT.Player(playerId, {
	    	events: {'onReady': createYTEvent(playerId)}
	  	});
	});
	
	function createYTEvent(playerId){ 
		return function (event) {
			var parent_div = $('#'+playerId).parents('.yt_parent');	
			var player = event.target // Set player reference
			player.mute();
			setTimeout(function(){
				player.pauseVideo();
			}, 2000);
			setTimeout(function(){
				parent_div.find('.overlay').fadeOut();
			}, 3000);	
			$(parent_div).hover(function(){
				player.seekTo(parent_div.data("start"), 'false');
				player.unMute();	
				player.playVideo();	
			}, function(){
				player.pauseVideo();
			});

		}
	}
});


